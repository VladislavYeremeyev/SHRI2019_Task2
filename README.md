# Задание 2. Напишите линтер

В этом репозитории находятся материалы тестового задания «Напишите линтер» для [15-й Школы разработки интерфейсов](https://yandex.ru/promo/academy/shri) (осень 2019, Москва).

## Задание

Описание условий задания можно прочитать [здесь](https://github.com/VladislavYeremeyev/SHRI2019_Task2/blob/master/TASK_DESCRIPTION.md).

## Конфигурация

### Используемые технологии

* Для решения данной задачи решил воспользоваться библиотекой [*json-to-ast*](https://github.com/vtrushin/json-to-ast), так как с её помощью можно эффективно обойти JSON-дерево и получить необходимую информацию о позициях символов сущностей. Также данная библиотека используется в [3 задании](https://github.com/VladislavYeremeyev/SHRI2019_Task3), и при использовании библиотеки линтер из этого задания может быть легко внедрен в задание №3.

* Использовал *Typescript*, так как было интересно изучить эту технологию, а также при внедрении линтера в [задание №3](https://github.com/VladislavYeremeyev/SHRI2019_Task3), общий код будет более консистентным (исходный код написан на Typescript).

* Для сборки использовал [*Gulp*](https://gulpjs.com/) в связке с [*Browserify*](http://browserify.org/). Было интересно изучить и попробовать в действии Gulp, а также он позволяет легко решать задачи сборки. Browserify позволил использовать объединенные CommonJs модули в браузере. Выходной файл `linter.js` также минифицируется с помощью `uglify`.

* Для контроля стиля и качества кода подключил [Prettier](https://prettier.io/) и [TSLint с конфигом AirBnb](https://github.com/progre/tslint-config-airbnb)

### Доступные NPM-скрипты

* `npm run compile-tsc` - компилирует все `.ts` файлы из папки `src` в папку `out`, используя конфиг из `tsconfig.json`
* `npm run build` - запускает компиляцию `.ts` файлов, а затем выполняет Gulp-таск, который склеивает все `.js` файлы из директории `out`, применяет `browserify` и `uglify` и на выходе дает файл `linter.js` в директории `build`
* `npm run prettier` - форматирует все `.ts` файлы из папки `src` с помощью `Prettier`
* `npm run lint` - форматирует все `.ts` файлы из папки `src` с помощью `TSLint` (Правила, к которым может быть применен autofix)

## Описание исходного кода

* `custom.d.ts` - здесь описаны типы сущностей, испоьзуемые библиотекой `jso-to-ast`
* `types.ts` - здесь описаны типы используемые в коде. Например, перечисления типов ошибки `RuleKeys` и её описания `RuleErrorText`, интерфейс объекта ошибки `ILinterProblem`, и константы с возможными размерами текста и отступов.
* `utils.ts` - здесь описаны вспомогательные функции, используемые в проекте. Например:
  * проверка является ли объект блоком (`isBlock`)
  * проверка является ли объект элементом (`isElement`)
  * функция возвращающая объект ошибки по её коду и объекту типа `JsonToAst.AstLocation` (`getLinterErrorData`)
  * функция получения объекта, находящегося в массиве миксов объекта дерева по заданным параметрам (`getMixedObject`)
  * функция получения значения модификатора по его имени (`getModValue`)
  * функция, возвращающая массив объектов с заданными параметрами, лежащих внутри данного объекта дерева (`getInnerEntities`) и т. д.
* `textHeadersCheck.ts` - файл с кодом, проверяющим правила валидации текстовых заголовков в дереве
* `formReferenceSizeCheck.ts` - файл с кодом, находящим эталонный размер элементов формы и проверяющий, что размер у элементов корректный
* `formHeaderCheck.ts` - файл с кодом, проверяющим правила валидации элементов формы `header`
* `formFooterCheck.ts` - файл с кодом, проверяющим правила валидации элементов формы `footer`
* `formContentItemElementCheck.ts` - файл с кодом, проверяющим правила валидации элементов формы `content-item`
* `formContentElementCheck.ts` - файл с кодом, проверяющим правила валидации элементов формы `content`
* `index.ts` - основной файл, создающий в глобальной области видимости функцию `lint`, которая валидирует входящую строку

## Линтер в действии

Работу линтера можно посмотреть в третьем задании в ветке [custom-linter](https://github.com/VladislavYeremeyev/SHRI2019_Task3/tree/custom-linter#5-%D0%B4%D0%BE%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE).

## Тесты

Для тестов использовал `mocha` + `chai`. Для запуска: `npm run test`.
